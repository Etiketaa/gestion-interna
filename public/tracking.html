<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Reparaci√≥n - Bit House</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
        }

        .tracking-container {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: var(--spacing-xl);
        }

        .tracking-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .tracking-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto var(--spacing-md);
        }

        .tracking-title {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .tracking-subtitle {
            color: var(--text-secondary);
        }

        .search-box {
            margin-bottom: var(--spacing-xl);
        }

        .search-input-group {
            display: flex;
            gap: var(--spacing-md);
        }

        .search-input-group .form-input {
            flex: 1;
            font-size: var(--font-size-lg);
            text-transform: uppercase;
        }

        .search-input-group .btn {
            padding: 0.75rem 1.5rem;
        }

        .result-box {
            display: none;
        }

        .result-box.active {
            display: block;
        }

        .equipment-info {
            background: var(--bg-secondary);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-lg);
        }

        .equipment-info h3 {
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .info-value {
            color: var(--text-primary);
        }

        .status-badge-large {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: var(--font-size-lg);
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .timeline-public {
            margin-top: var(--spacing-lg);
        }

        .timeline-public h3 {
            margin-bottom: var(--spacing-lg);
        }
    </style>
</head>

<body>
    <div class="tracking-container">
        <div class="tracking-header">
            <div class="tracking-logo">üè†</div>
            <h1 class="tracking-title">Bit House</h1>
            <p class="tracking-subtitle">Seguimiento de Reparaci√≥n</p>
        </div>

        <div class="search-box">
            <div class="search-input-group">
                <input type="text" id="order-number-input" class="form-input" placeholder="BH-2024-0001" maxlength="13">
                <button class="btn btn-primary" onclick="buscarOrden()">
                    üîç Buscar
                </button>
            </div>
            <small style="display: block; margin-top: var(--spacing-sm); color: var(--text-secondary);">
                Ingrese el n√∫mero de orden que recibi√≥ al dejar su equipo
            </small>
        </div>

        <div id="result-box" class="result-box">
            <!-- Los resultados se cargan aqu√≠ -->
        </div>
    </div>

    <script src="/js/utils.js"></script>
    <script>
        // Buscar al presionar Enter
        document.getElementById('order-number-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                buscarOrden();
            }
        });

        async function buscarOrden() {
            const input = document.getElementById('order-number-input');
            const numeroOrden = input.value.trim().toUpperCase();
            const resultBox = document.getElementById('result-box');

            if (!numeroOrden) {
                alert('Por favor ingrese un n√∫mero de orden');
                return;
            }

            try {
                showLoading();
                const data = await apiRequest(`/tracking/${numeroOrden}`);
                mostrarResultado(data);
                resultBox.classList.add('active');
            } catch (error) {
                resultBox.innerHTML = `
                    <div class="error-message">
                        <strong>‚ùå No encontrado</strong><br>
                        ${error.message || 'Verifique que el n√∫mero de orden sea correcto'}
                    </div>
                `;
                resultBox.classList.add('active');
            } finally {
                hideLoading();
            }
        }

        function mostrarResultado(data) {
            const { equipo, historial, presupuesto } = data;
            const resultBox = document.getElementById('result-box');

            const estadoColor = {
                'ingresado': '#94a3b8',
                'diagnostico': '#3b82f6',
                'presupuestado': '#f59e0b',
                'en_reparacion': '#8b5cf6',
                'listo': '#10b981',
                'en_camino': '#06b6d4',
                'entregado': '#6b7280'
            };

            const estadoTexto = {
                'ingresado': 'Ingresado',
                'diagnostico': 'En Diagn√≥stico',
                'presupuestado': 'Presupuestado',
                'en_reparacion': 'En Reparaci√≥n',
                'listo': 'Listo para Retirar',
                'en_camino': 'En Camino',
                'entregado': 'Entregado'
            };

            let html = `
                <div class="equipment-info">
                    <h3>üì± Informaci√≥n del Equipo</h3>
                    <div class="info-row">
                        <span class="info-label">N√∫mero de Orden:</span>
                        <span class="info-value"><strong>${equipo.numero_orden}</strong></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Equipo:</span>
                        <span class="info-value">${equipo.marca} ${equipo.modelo}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Sistema:</span>
                        <span class="info-value">${getSOBadge(equipo.sistema_operativo)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Fecha de Ingreso:</span>
                        <span class="info-value">${formatDateShort(equipo.fecha_ingreso)}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Estado Actual:</span>
                        <span class="info-value">
                            <span class="status-badge-large" style="background: ${estadoColor[equipo.estado_actual]}20; color: ${estadoColor[equipo.estado_actual]};">
                                ${estadoTexto[equipo.estado_actual]}
                            </span>
                        </span>
                    </div>
                </div>
            `;

            if (presupuesto && presupuesto.estado === 'aceptado') {
                html += `
                    <div class="equipment-info">
                        <h3>üí∞ Presupuesto</h3>
                        <div class="info-row">
                            <span class="info-label">Total:</span>
                            <span class="info-value"><strong>${formatCurrency(presupuesto.total)}</strong></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Estado:</span>
                            <span class="info-value">${getPresupuestoBadge(presupuesto.estado)}</span>
                        </div>
                    </div>
                `;
            }

            if (historial && historial.length > 0) {
                html += `
                    <div class="timeline-public">
                        <h3>üìã Historial</h3>
                        <div class="timeline">
                            ${historial.map(h => `
                                <div class="timeline-item">
                                    <div class="timeline-content">
                                        <div><strong>${estadoTexto[h.estado_nuevo] || h.estado_nuevo.toUpperCase()}</strong></div>
                                        ${h.observaciones ? `<div>${h.observaciones}</div>` : ''}
                                        <div class="timeline-date">${formatDate(h.fecha_cambio)}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            if (equipo.estado_actual === 'listo') {
                html += `
                    <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: #d1fae5; border-radius: var(--border-radius); text-align: center;">
                        <strong style="color: #065f46;">‚úÖ Su equipo est√° listo para retirar</strong><br>
                        <small style="color: #047857;">Por favor comun√≠quese con nosotros para coordinar la entrega</small>
                    </div>
                `;
            }

            resultBox.innerHTML = html;
        }
    </script>
</body>

</html>